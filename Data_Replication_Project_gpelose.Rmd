---
title: "Data Replication Assignment"
author: "Greg Pelose"
date: "12/6/2019"
output: 
  html_document:
    theme: cosmo
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	comment = "##",
	prompt = FALSE,
	tidy = TRUE,
	tidy.opts = list(width.cutoff = 75),
	fig.path = "img/"
)
```

***

#Introduction

***

Astraniga pocualta is a faculatively symbiotic coral species that is Native to New England. Its capabilities to live with or without zoozanthaellie is that makes this organism faculatively symbiotic and thus a model organism for studying coral bleaching. 
</br>

This study focuses on looking at how microplastics are affecting Astrangia poculata. 

![Astrania Poculata eating Microplastic beads and Brine Shrimp eggs](img/coral:beads.png)

##Methodology 

Colonies of wild Astrangia poculata were collected and decalcified, they were then opened up to allow for the gastrocavity to be analyzed. They counted the amount of microplastics that they found represented by Figure 1 below. They also divided the colonies into top, middle and bottom to see which portions of the coral had the greatest amount of microplastics shown by Figure 2 below. 

![Decalcified polyp of Astraniga Poculata](img/decal.png)

Following this, Rotjan et al. wanted to see how feeding microsplastics to colonies of Astrangia poculata will affect the amount of copepods, brine shrimp, and brine shrimp eggs that they would eat 15 minutes after. They ran t-tests, a permuation tests, and a paired permutation test to see if there was any significance between these experiments.   
  
##Getting data from excel into R

***

These are the packages that you will need to run my replication assignment.
I used the function called readxl to pull my dad in from the excell file that I have been working from. 
```{r, results='hide', error=FALSE, warning=FALSE, message=FALSE}
library(knitr)
library(readxl)
library(readxl)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(dplyr)
library(ggpubr)
library(wPerm)
library(lmPerm)
```

***

#Figure 1

***

##To start, you need to pull in the data from R. 

```{r}
Figure_1 <- read_excel("individual_project.xlsx", 
    sheet = "GP-Fig.1")
head(Figure_1)
```

##Creating a plot in ggplot

```{r,fig.width=4,fig.height=4}
ggplot(data=Figure_1,aes(x=MP_type,y=MP_count))+geom_boxplot()+xlab("Plastic Type")+ylab("no. plastics per polyp")+scale_y_continuous(lim=c(0,100),breaks=c(0,20,40,60,80,100))+theme_classic()+annotate("text", x = "Beads", y = 30, label = "A")+annotate("text", x = "Fibers", y = 92, label = "B")+annotate("text", x = "Misc", y = 22, label = "A")+theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

***

#Figure 2

***

##Pulling data in from Excel 
```{r}
Figure_2 <- read_excel("individual_project.xlsx", 
    sheet = "GP-Fig.2")
head(Figure_2)
```

##Using ggplot to create Figure 2

```{r, fig.width=5,fig.height=4}
plot_2 <- ggplot(Figure_2, aes(x=colony,y=MP_ingested))
plot_2 + geom_histogram(stat="identity",aes(fill=location))+annotate("text", x = 1, y = 100, label = "57.5%")+annotate("text", x = 2, y = 135, label = "74.7%")+annotate("text", x = 3, y = 19, label = "88.6%")+scale_y_continuous(lim=c(0,250),breaks=c(0,50,100,150,200,250))
```

***

#Figure 3

***

##pulling data in from excel
```{r}
Figure_3 <- read_excel("individual_project.xlsx", 
     sheet = "GP-Fig.3")
head(Figure_3)
```

##Using ggplot to create Figure 3 
```{r, fig.width=3,fig.height=4}
ggplot(data=Figure_3,aes(x=intake,y=particles_consumed))+geom_boxplot()+xlab("")+ylab("particles consumed (mm^3)")+scale_y_continuous(lim=c(0,3),breaks=c(0,1,2,3))+theme_classic()+theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

***

#Figure 4 

***

##Plot 1!

```{r}
Fig.4_plot.1 <- read_excel("individual_project.xlsx", 
    sheet = "GP-Fig.4-Cope")
head(Fig.4_plot.1)
```

```{r,fig.width=4,fig.height=4}
Figure_4_plot_1 <- ggplot(Fig.4_plot.1, aes(x=treatment,y=copepods))
copepods <- Figure_4_plot_1 + geom_violin()+theme_classic()
copepods
```

***

##Plot 2 from figure 4

```{r}
Fig.4_plot.2 <- read_excel("individual_project.xlsx", 
    sheet = "GP-Fig.4-Brine")
head(Fig.4_plot.2)
```


```{r,fig.width=4,fig.height=4}
Figure_4_plot_2 <- ggplot(Fig.4_plot.2, aes(x=treatment,y=brine))
brine <- Figure_4_plot_2 + geom_violin()+theme_classic()
brine
```

***

##Plot 3 from figure 4

```{r}
Fig.4_plot.3 <- read_excel("individual_project.xlsx", 
    sheet = "GP-Fig.4-Egg")
summary(Fig.4_plot.3)
```


```{r,fig.width=4,fig.height=4}
Figure_4_plot_3 <- ggplot(Fig.4_plot.3, aes(x=treatment,y=eggs))
eggs <- Figure_4_plot_3 + geom_violin()+theme_classic()
eggs
```

***

##Adding all three together
```{r, fig.width=3,fig.height=8}
grid.arrange(copepods, brine, eggs)
```

#Statistical Analysis

## Normality tests between plot 1 figure 4.

```{r}
ggqqplot(Fig.4_plot.1$copepods)
```

```{r}
shapiro.test(Fig.4_plot.1$copepods)
```

From this output we can say that the data is normal, but the sample size is very small and is actually less than 30 I do not think that they can have the full confidence to say that this data is normal. 

```{r}
tt <- t.test(copepods~treatment,data=Fig.4_plot.1,var.equal=TRUE)
tt
```

I ran a t-test and recieved the same p-value of .03 as Rotjan et al. 



##statistical analysis from plot 2 figure 4

```{r}
shapiro.test(Fig.4_plot.2$brine)
```

I got that the p-value is not normal due to a p-vlaue less that .05. In the paper they stated that they ran paired permutaton test when the data was not normal. 

```{r}
ggqqplot(Fig.4_plot.2$brine)
```

This data also does not pass the visual test as there is one oulier on the top. 

```{r}
tt2 <- t.test(brine~treatment,data=Fig.4_plot.2,var.equal=TRUE)
tt2
```

I got the same value for my t-test as they did in the paper of .6, this shows to not be significant as the paper also said but I do not think that it is okay to run a ttest with non-normal data. so here is my attempt at a permutation test below. 

```{r}

p2 <- aovp(brine ~ treatment, data=Fig.4_plot.2)
summary(p2)
```

##Statistical Analysis from plot 3 figure 4

```{r}
shapiro.test(Fig.4_plot.3$eggs)
```

```{r}
ggqqplot(Fig.4_plot.3$eggs)
```
This data is also not normal as we see an outlier in the visual test and we also see that the p-value is less than .05. I also am concerned that we have such a small sample size as well. Either way the paper states that when the data did not show normality from a shapiro wilks test they used a paired permutation test. 

```{r}
p3 <- aovp(eggs ~ treatment, data=Fig.4_plot.3)
summary(p3)
```


***

#Figure 5

***

```{r}
Figure_5 <- read_excel("individual_project.xlsx", 
    sheet = "GP-Fig.5")
summary(Figure_5)
plot(Figure_5)
```

##Using ggplot to create Figure 5.

```{r}
plot_5 <- ggplot(Figure_5, aes(x="brine shrimp egg ingestion (mm^3)",y="Microplastic Ingestion (mm^3)"))
plot_5 + geom_jitter() + theme_classic()
```

#Statistics for figure 5

I ran the same permutation test that they ran and got the same results as they did. I know that we were only supposed to run one analysis of statistics but I wanted to try and run a paired permutation test and I think that it worked.

```{r}
perm.paired.loc(Figure_5$microplastic_ingestion, Figure_5$bse_ingestion, mean, variable = NULL,
                alternative = c("two.sided", "less", "greater"),
                R = 9999)
```


***

#Discussion/Results

I found that I was able to create most of the graphical figures with a few minor differences. I found that at the end of the 

***

I was able 



#Limitations
* In Figure_2 I was unable to move the legend to the top, I would do this in photo shop if I had access to the application.
* I ran my violin plots with the data that I was given and found that my results were not as amplified as the ones shown in the paper. 
* Since the sample size is smaller than 30 should I be using 
* how do I get my excell file onto github so that others can use it!
* QUESTION# should I be using a gossets distribution?

